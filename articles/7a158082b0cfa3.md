---
title: ""
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---

æ¥­å‹™ã§ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆUIãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã‚’å®Ÿç¾ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã¾ã—ãŸã€‚çŠ¶æ…‹ç®¡ç†ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã«é–¢ã—ã¦ã„ã‚ã„ã‚è€ƒãˆã‚‹ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§ã€å®Ÿè£…ä¸­ä½•ã‚’è€ƒãˆã¦ã„ãŸã®ã‹ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ã¦è¨˜äº‹ã«ã¾ã¨ã‚ã¾ã—ãŸã€‚

ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã«é–¢ã™ã‚‹èª¬æ˜ã¯[ã‚½ã‚·ã‚ªãƒ¡ãƒ‡ã‚£ã‚¢ã•ã‚“ã®è¨˜äº‹](https://www.sociomedia.co.jp/1284)ãŒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§ã€ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## å®Ÿè£…ã—ãŸã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚´ãƒ¼ãƒ«ã‚’è€ƒãˆã‚‹

ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã«ã‚ãŸã‚Šã€ã©ã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚’ã©ã®ã‚ˆã†ãªAPIã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ‰±ã„ãŸã„ã‹ã‚’è€ƒãˆã¾ã™ã€‚

æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã¯ã€å¤§åˆ†é¡>ä¸­åˆ†é¡>å°åˆ†é¡ã®ã‚ˆã†ã«éšå±¤çš„ã«ãªã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æƒ³å®šã—ã¾ã™ã€‚ãŸã¨ãˆã°æ¬¡ã®ã‚ˆã†ãªéƒ¨ç½²>ãƒãƒ¼ãƒ >ãƒ¡ãƒ³ãƒãƒ¼ãŒéšå±¤æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

```typescript:src/data.ts
type Department = { id: string; name: string; teams: Team[] };
type Team = { id: string; name: string; members: Member[] };
type Member = { id: string; name: string };

export const departments: Department[] = [
  {
    id: 'dep-eng',
    name: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨',
    teams: [
      {
        id: 'team-fe',
        name: 'ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-001', name: 'ä½è—¤ æ²™ç¾…' },
          { id: 'mem-002', name: 'ç”°ä¸­ æ…å¾' },
        ],
      },
      {
        id: 'team-be',
        name: 'ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-003', name: 'å±±ç”° çœŸå¤®' },
          { id: 'mem-004', name: 'éˆ´æœ¨ ç¿”å¤ª' },
        ],
      },
    ],
  },
  {
    id: 'dep-sales',
    name: 'å–¶æ¥­éƒ¨',
    teams: [
      {
        id: 'team-domestic',
        name: 'å›½å†…å–¶æ¥­ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-005', name: 'é«˜æ©‹ ç›´å­' },
          { id: 'mem-006', name: 'æ¸¡è¾º æ´‹ä»‹' },
        ],
      },
      {
        id: 'team-global',
        name: 'æµ·å¤–å–¶æ¥­ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-007', name: 'ä¼Šè—¤ ç´”å¹³' },
          { id: 'mem-008', name: 'ä¸­æ‘ æµ' },
        ],
      },
    ],
  },
  {
    id: 'dep-marketing',
    name: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°éƒ¨',
    teams: [
      {
        id: 'team-content',
        name: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°',
        members: [
          { id: 'mem-009', name: 'çŸ³äº• æ™ºå­' },
          { id: 'mem-010', name: 'æ£® å¤§è¼”' },
        ],
      },
      {
        id: 'team-growth',
        name: 'ã‚°ãƒ­ãƒ¼ã‚¹ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-011', name: 'æ± ç”° æ˜' },
          { id: 'mem-012', name: 'æ©‹æœ¬ å½©èŠ±' },
        ],
      },
    ],
  },
  {
    id: 'dep-hr',
    name: 'äººäº‹éƒ¨',
    teams: [
      {
        id: 'team-recruit',
        name: 'æ¡ç”¨ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-013', name: 'é˜¿éƒ¨ é‡Œå¥ˆ' },
          { id: 'mem-014', name: 'ç¦ç”° å‰›' },
        ],
      },
      {
        id: 'team-training',
        name: 'è‚²æˆãƒ»ç ”ä¿®ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-015', name: 'è—¤ç”° ç¿”' },
          { id: 'mem-016', name: 'è¥¿æ‘ ä½³å¥ˆ' },
        ],
      },
    ],
  },
  {
    id: 'dep-cs',
    name: 'ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µã‚¯ã‚»ã‚¹éƒ¨',
    teams: [
      {
        id: 'team-onboarding',
        name: 'ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-017', name: 'å¤ªç”° ç¿”å­' },
          { id: 'mem-018', name: 'ä¸‰æµ¦ è³¢ä¸€' },
        ],
      },
      {
        id: 'team-support',
        name: 'ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ ',
        members: [
          { id: 'mem-019', name: 'å²¡ç”° ä¿®å¹³' },
          { id: 'mem-020', name: 'é•·è°·å· åƒå°‹' },
        ],
      },
    ],
  },
];
```

æ¬¡ã«ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæŒã¤å¿…è¦ãŒã‚ã‚‹æ©Ÿèƒ½ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®ãŸã‚ã«ã‚ã‚‹ã¨æœ›ã¾ã—ã„æ©Ÿèƒ½ã‚’è€ƒãˆã¾ã™ã€‚

- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæŒã¤å¿…è¦ãŒã‚ã‚‹æ©Ÿèƒ½
  - å¤§åˆ†é¡ã‹ã‚‰å°åˆ†é¡ã¸ã¨éšå±¤çš„ã«æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã®ç‰¹å®šã®1éšå±¤ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹
  - å¤§åˆ†é¡ã‹ã‚‰å°åˆ†é¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ˜ã‚Šä¸‹ã’ã‚‹ã‚ˆã†ã«è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹
  - å°åˆ†é¡ã‹ã‚‰å¤§åˆ†é¡ã«æˆ»ã‚‹ã‚ˆã†ã«è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®ãŸã‚ã«ã‚ã‚‹ã¨æœ›ã¾ã—ã„æ©Ÿèƒ½
  - è¡¨ç¤ºã®åˆ‡æ›¿æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéšå±¤æ§‹é€ ã‚’èªè­˜ã—ã‚„ã™ãã™ã‚‹

æ‰±ã†ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ©Ÿèƒ½ã‚’å¿µé ­ã«ç½®ãã¤ã¤ã€**ã¾ãšã¯å®Ÿç¾å¯èƒ½æ€§ã‚’è€ƒãˆã™ããšã«**ç†æƒ³çš„ãªAPIã‚’è€ƒãˆã¾ã™ã€‚éšå±¤æ§‹é€ ã‚’å®£è¨€çš„ã«è¡¨ç¾ã§ãã‚‹ã‚ˆã†ãªå½¢ã®APIãŒæœ›ã¾ã—ã„ã§ã™ã€‚

```tsx:src/App.tsx
import { DrillDown, DrillDownLayer } from './components/drill-down/drill-down';
import { DepartmentList } from './components/department-list/department-list';
import { Department } from './components/department/department';
import { Team } from './components/team/team';
import { Member } from './components/member/member';
import { departments } from './data';

import type { FC } from 'react';

const App: FC = () => {
  return (
    <DrillDown>
      <DrillDownLayer
        name="root"
        content={<DepartmentList departments={departments} />}
      >
        {departments.map((department) => (
          <DrillDownLayer
            key={department.id}
            name={department.id}
            content={<Department department={department} />}
          >
            {department.teams.map((team) => (
              <DrillDownLayer
                key={team.id}
                name={team.id}
                content={<Team team={team} />}
              >
                {team.members.map((member) => (
                  <DrillDownLayer
                    key={member.id}
                    name={member.id}
                    content={<Member member={member} />}
                  />
                ))}
              </DrillDownLayer>
            ))}
          </DrillDownLayer>
        ))}
      </DrillDownLayer>
    </DrillDown>
  );
};
export default App;

```

`DepartmentList`ã€`Department`ã€`Team`ã€`Member`ã¯ãã‚Œãã‚Œã®éšå±¤ã«å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚å†…éƒ¨ã§`useDrillDown`ãƒ•ãƒƒã‚¯ã‚’ä½¿ã£ã¦ã€è¡¨ç¤ºã®åˆ‡æ›¿ã‚„æˆ»ã‚‹æ“ä½œã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```tsx:src/components/department-list/department-list.tsx
import { useDrillDown } from '../drill-down/drill-down';
import { useCallback } from 'react';

import type { Department } from '../../data';
import type { FC, MouseEventHandler } from 'react';

type RootProps = {
  departments: Department[];
};
export const DepartmentList: FC<RootProps> = ({ departments }) => {
  const { navigate } = useDrillDown();

  type OnClickDepartment = (
    departmentId: string
  ) => MouseEventHandler<HTMLButtonElement>;
  const onClickDepartment = useCallback<OnClickDepartment>(
    (departmentId) => (_event) => {
      navigate(departmentId);
    },
    [navigate]
  );

  return (
    <div>
      <header>éƒ¨ç½²ä¸€è¦§</header>
      <ul>
        {departments.map((department) => (
          <li key={department.id}>
            <button onClick={onClickDepartment(department.id)}>
              {department.name}
            </button>
          </li>
        ))}
      </ul>
    </div>
  );
};

```

```tsx:src/components/department/department.tsx
import type { Department as DepartmentType } from "../../data";
import { useCallback, type FC, type MouseEventHandler } from 'react'
import { useDrillDown } from "../drill-down/drill-down";

type Props = {
  department: DepartmentType;
};
export const Department: FC<Props> = ({ department }) => {
  const { navigate, back } = useDrillDown();

  type OnClickBack = MouseEventHandler<HTMLButtonElement>;
  const onClickBack = useCallback<OnClickBack>((_event) => {
    back();
  }, [back]);

  type OnClickTeam = (teamId: string) => MouseEventHandler<HTMLButtonElement>;
  const onClickTeam = useCallback<OnClickTeam>((teamId) => (_event) => {
    navigate(teamId);
  }, [navigate]);

  return (
    <div>
      <button onClick={onClickBack}>æˆ»ã‚‹</button>
      <header>{department.name}ã®ãƒãƒ¼ãƒ ä¸€è¦§</header>
      <ul>
        {department.teams.map((team) => (
          <li key={team.id}>
            <button onClick={onClickTeam(team.id)}>
              {team.name}
            </button>
          </li>
        ))}
      </ul>
    </div>
  );
};

```

```tsx:src/components/team/team.tsx
import { type Team as TeamType } from '../../data';
import { useCallback, type FC, type MouseEventHandler } from 'react';
import { useDrillDown } from '../drill-down/drill-down';

type Props = {
  team: TeamType;
};
export const Team: FC<Props> = ({ team }) => {
  const { navigate, back } = useDrillDown();

  type OnClickBack = MouseEventHandler<HTMLButtonElement>;
  const onClickBack = useCallback<OnClickBack>(
    (_event) => {
      back();
    },
    [back]
  );

  type OnClickTeam = (memberId: string) => MouseEventHandler<HTMLButtonElement>;
  const onClickMember = useCallback<OnClickTeam>(
    (memberId) => (_event) => {
      navigate(memberId);
    },
    [navigate]
  );

  return (
    <div>
      <button onClick={onClickBack}>æˆ»ã‚‹</button>
      <header>{team.name}ã®ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§</header>
      <ul>
        {team.members.map((member) => (
          <li key={member.id}>
            <button onClick={onClickMember(member.id)}>{member.name}</button>
          </li>
        ))}
      </ul>
    </div>
  );
};

```

```tsx:src/components/member/member.tsx
import type { Member as MemberType } from '../../data';
import { useCallback, type FC, type MouseEventHandler } from 'react';
import { useDrillDown } from '../drill-down/drill-down';

type Props = {
  member: MemberType;
};
export const Member: FC<Props> = ({ member }) => {
  const { back } = useDrillDown();

  type OnClickBack = MouseEventHandler<HTMLButtonElement>;
  const onClickBack = useCallback<OnClickBack>(
    (_event) => {
      back();
    },
    [back]
  );

  return (
    <div>
      <button onClick={onClickBack}>æˆ»ã‚‹</button>
      <header>{member.name}ã®è©³ç´°</header>
    </div>
  );
};

```

ã“ã®APIã§ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ã€`DrillDown`ã€`DrillDownLayer`ã€`useDrillDown`ã®å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚

ã¾ãšã¯ã€å‹ã¨ç©ºã£ã½ã®å®Ÿè£…ã ã‘å®šç¾©ã—ã¦ãŠãã¾ã™ã€‚

```tsx:src/components/drill-down/drill-down.tsx
export const DrillDown: FC<PropsWithChildren> = ({ children }) => {
  return null;
};

type DrillDownLayerProps = {
  name: string;
  content: ReactNode;
};
export const DrillDownLayer: FC<PropsWithChildren<DrillDownLayerProps>> = ({ children, name, content }) => {
  return null;
};

type UseDrillDown = () => {
  navigate: Navigate;
  back: Back;
};
type Navigate = (next: string) => void;
type Back = () => void;
export const useDrillDown: UseDrillDown = () => {
  const navigate = useCallback<Navigate>((next) => {}, []);
  const back = useCallback<Back>(() => {}, []);

  return { navigate, back };
};
```

ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã‚’ã€StackBlitzã§ç¢ºèªã§ãã¾ã™ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-fdwuzqdv?file=src%2FApp.tsx&view=editor)

## éšå±¤ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’è€ƒãˆã‚‹

éšå±¤ã‚’è¡¨ç¤ºã™ã‚‹/éšå±¤ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã®çŠ¶æ…‹ç®¡ç†ã‚’è€ƒãˆã¾ã™ã€‚

éšå±¤ã®å‹ã‚’`Layer`ã¨ã—ã€éšå±¤æ§‹é€ ã¯`Layer[]`ã§ã‚ã‚‹ã¨è¦‹ç«‹ã¦ã¦ã¿ã‚‹ã¨ã€

- é…åˆ—ã®æœ«å°¾ã®è¦ç´ ãŒç¾åœ¨ã®éšå±¤ã§ã‚ã‚Šã€ç”»é¢ã«è¡¨ç¤ºã™ã¹ãéšå±¤ã§ã‚ã‚‹
- `navigate`ã‚’å‘¼ã³å‡ºã™ã¨ã€é…åˆ—ã®æœ«å°¾ã«æ–°ã—ã„éšå±¤ã‚’è¿½åŠ ã™ã‚‹
- `back`ã‚’å‘¼ã³å‡ºã™ã¨ã€é…åˆ—ã®æœ«å°¾ã®è¦ç´ ã‚’å‰Šé™¤ã™ã‚‹

ã¨ã„ã†ä»•çµ„ã¿ã§ã€ç‰¹å®šã®éšå±¤ã ã‘ã‚’è¡¨ç¤ºã—ãŸã‚Šã€è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆãŸã‚Šã§ããã†ã§ã™ã€‚

ã¾ãšã€`Layer`ã¯éšå±¤ã‚’è­˜åˆ¥ã§ãã‚‹åå‰ã ã‘ã‚’`string`ã§æŒã¤ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```tsx
type Layer = string;
```

ãŸã¨ãˆã°éƒ¨ç½²ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹`"root"`éšå±¤ã‚’åˆæœŸå€¤ã¨ã™ã‚‹ï¼ˆæœ€åˆã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ãŒéƒ¨ç½²ä¸€è¦§ã§ã‚ã‚‹ã¨ã™ã‚‹ï¼‰ã¨ã€stateã®å®šç¾©ã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
 const [layers, setLayers] = useState<Layer[]>(['root']);
```

ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯`navigate("dep-eng")`ã—ã¾ã™ã€‚`layers`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
['root', 'dep-eng']
```

ã•ã‚‰ã«ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯`navigate("team-fe")`ã—ã¾ã™ã€‚`layers`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
['root', 'dep-eng', 'team-fe']
```

`back()`ã—ãŸå ´åˆã¯ã€é…åˆ—ã®æœ«å°¾ã‚’å‰Šé™¤ã—ã¦ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
['root', 'dep-eng']
```

ã“ã®ä»•çµ„ã¿ã‚’`DrillDown`ã€`DrillDownLayer`ã€`useDrillDown`ã«å®Ÿè£…ã—ã¾ã™ã€‚

## çŠ¶æ…‹ç®¡ç†ã‚’å®Ÿè£…ã™ã‚‹

èª°ãŒ`layers`ã‚’å‚ç…§ã™ã‚‹ã®ã‹ã€èª°ãŒ`setLayers`ã‚’ä½¿ã£ã¦çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã®ã‹ã‚’è€ƒãˆã¾ã™ã€‚

- `DrillDownLayer`ã¯`layers`ã‚’å‚ç…§ã™ã‚‹
  - props`name`ã‚’ä½¿ã£ã¦`layers`ã‹ã‚‰è‡ªèº«ã®éšå±¤ã‚’ç‰¹å®šã™ã‚‹
  - é…åˆ—ã®æœ«å°¾ã®è¦ç´ ãŒè‡ªèº«ã®éšå±¤ã§ã‚ã‚Œã°ã€props`content`ã‚’è¡¨ç¤ºã™ã‚‹
- `useDrillDown`ã¯`setLayers`ã‚’ä½¿ã£ã¦çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
  - `navigate`/`back`ã‚’å‘¼ã³å‡ºã™ã¨ã€`layers`ã®çŠ¶æ…‹ãŒæ›´æ–°ã•ã‚Œã‚‹

`DrillDown`ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ã—ã¦å®Ÿè£…ã—ã¦ã€`DrillDownLayer`ã¨`useDrillDown`ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€è¤‡æ•°ã®`DrillDownLayer`ã¨`useDrillDown`ãŒåŒä¸€ã®`layers`ã‚’å…±æœ‰ã§ãã€éšå±¤ã®è¡¨ç¤ºåˆ¶å¾¡ã‚’ä¸€å…ƒç®¡ç†ã§ãã¾ã™ã€‚

ã¾ãšcontextã‚’å®šç¾©ã—ã€`DrillDown`ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ã—ã¦å®Ÿè£…ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
+ import { useCallback, createContext, useState, use } from 'react';
+ import type {
+   FC,
+   PropsWithChildren,
+   ReactNode,
+   Dispatch,
+   SetStateAction,
+ } from 'react';

+ type Layer = string;
+ const LayersStateContext = createContext<
+   | [layers: Layer[], setLayer: Dispatch<SetStateAction<Layer[]>>]
+   | null
+ >(null);
+
+ type DrillDownProps = {
+   initialLayer: Layer; // TODO: åˆæœŸè¡¨ç¤ºã‚’æ±ºã‚ã‚‹ãŸã‚ã«å¿…è¦ã ãŒã€ã§ãã‚Œã°ãªãã—ãŸã„
+ };
- export const DrillDown: FC<PropsWithChildren> = ({ children }) => {
-   return null;
+ export const DrillDown: FC<PropsWithChildren<DrillDownProps>> = ({ children, initialLayer }) => {
+   const [layers, setLayers] = useState<Layer[]>([initialLayer]);
+ 
+   return (
+     <LayersStateContext.Provider value={[layers, setLayers]}>
+       {children}
+     </LayersStateContext.Provider>
+   );
  };
```

`DrillDownLayer`ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‚ç…§ã—ã¾ã™ã€‚`layers`ã‹ã‚‰è‡ªèº«ã®éšå±¤ã‚’ç‰¹å®šã—ã€è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¤å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¡ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
  export const DrillDownLayer: FC<PropsWithChildren<DrillDownLayerProps>> = ({ children, name, content }) => {
-   return null;
+   const context = use(LayersStateContext);
+   if (context === null) {
+     throw new Error('DrillDownLayer must be used within DrillDown');
+   }
+   const [layers] = context;
+   const ownLayer = layers.find((layer) => layer === name);
+   if (!ownLayer) return null;
+ 
+   const isCurrentLayer = ownLayer === layers.at(-1);
+ 
+   return isCurrentLayer
+     ? content
+     : children;
};
```

`useDrillDown`ã§ã‚‚ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‚ç…§ã—ã¾ã™ã€‚`layers`ã®æœ«å°¾ã«æ–°ã—ã„éšå±¤ã‚’è¿½åŠ ã™ã‚‹`navigate`ã¨ã€æœ«å°¾ã®éšå±¤ã‚’å‰Šé™¤ã™ã‚‹`back`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
  export const useDrillDown: UseDrillDown = () => {
+   const context = use(LayersStateContext);
+   if (context === null) {
+     throw new Error('useDrillDown must be used within DrillDown');
+   }
+   const [, setLayers] = context;
+
-   const navigate = useCallback<Navigate>((next) => {}, []);
+   const navigate = useCallback<Navigate>((next) => {
+     setLayers((layers) => [
+       ...layers,
+       next,
+     ]);
+   }, [setLayers]);
-   const back = useCallback<Back>(() => {}, []);
+   const back = useCallback<Back>(() => {
+     setLayers((layers) => layers.slice(0, -1));
+   }, [setLayers]);
  
    return { navigate, back };
  };
```

`DrillDown`ã®propsã«`initialLayer`ãŒå¿…è¦ã«ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã€Storybookã®`DrillDownDemo`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«`initialLayer`ã‚’æ¸¡ã™ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff tsx:src/App.tsx
  const DrillDownDemo: FC = () => {
    return (
-     <DrillDown>
+     <DrillDown initialLayer="root">
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã®ã€ç´ æœ´ãªãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã§ãã¾ã—ãŸã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-zpmgfawk?file=src%2Fcomponents%2Fdrill-down%2Fdrill-down.tsx)

## ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®çŠ¶æ…‹ç®¡ç†ã‚’è€ƒãˆã‚‹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒéšå±¤æ§‹é€ ã‚’èªè­˜ã—ã‚„ã™ããªã‚‹ã‚ˆã†ã«ã€æ¬¡ã®ã‚ˆã†ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

- å¤§åˆ†é¡ã‹ã‚‰å°åˆ†é¡ã¸æ˜ã‚Šä¸‹ã’ãŸã¨ã
  - å°åˆ†é¡ãŒå³ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã—ã¦ãã‚‹
  - å¤§åˆ†é¡ã¯å·¦ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦ã„ã
- å°åˆ†é¡ã‹ã‚‰å¤§åˆ†é¡ã«æˆ»ã‚‹ã¨ã
  - å¤§åˆ†é¡ãŒå·¦ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã—ã¦ãã‚‹
  - å°åˆ†é¡ã¯å³ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦ã„ã

ç¾åœ¨ã¯1ã¤ã®éšå±¤ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®å®Ÿè£…ã«ãªã£ã¦ã„ã¾ã™ãŒã€

- æ˜ã‚Šä¸‹ã’ãŸã¨ãã«ã¯ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã—ã¦ãã‚‹éšå±¤ã¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦ã„ãéšå±¤ã‚’
- æˆ»ã‚‹ã¨ãã«ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã—ã¦ãã‚‹éšå±¤ã¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦ã„ãéšå±¤ã‚’

åŒæ™‚ã«è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å„`layer`ã«è¡¨ç¤ºçŠ¶æ…‹ã‚’è¡¨ã™`state`ã‚’æŒãŸã›ã¦ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå§‹ã¾ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ»çµ‚ã‚ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯2ã¤ã®éšå±¤ãŒåŒæ™‚ã«è¡¨ç¤ºã•ã‚Œã€ãã‚Œãã‚ŒãŒç•°ãªã‚‹æ–¹å‘ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã¯ä¸è¦ã«ãªã£ãŸéšå±¤ã‚’é©åˆ‡ã«å‡¦ç†ï¼ˆéè¡¨ç¤ºã¾ãŸã¯å‰Šé™¤ï¼‰ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
- type Layer = string;
+ type Layer = {
+   name: string;
+   state:
+     | 'active' // è¡¨ç¤ºã—ã¦ã„ã‚‹éšå±¤ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ï¼‰
+     | 'enteringOnNavigate' // navigateã—ãŸã¨ãã«æ–°ã—ãè¡¨ç¤ºã•ã‚Œã‚‹éšå±¤
+     | 'exitingOnNavigate' // navigateã—ãŸã¨ãã«éè¡¨ç¤ºã«ã•ã‚Œã‚‹éšå±¤
+     | 'enteringOnBack' // backã—ãŸã¨ãã«æ–°ã—ãè¡¨ç¤ºã•ã‚Œã‚‹éšå±¤
+     | 'exitingOnBack' // backã—ãŸã¨ãã«éè¡¨ç¤ºã«ã•ã‚Œã‚‹éšå±¤
+     | 'invisible'; // éè¡¨ç¤ºã®éšå±¤
+ };
```

ãŸã¨ãˆã°éƒ¨ç½²ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹å ´åˆã®`layers`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
[
  { name: 'root', state: 'active' },
]
```

ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨ã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯`navigate("dep-eng")`ã—ã¦ã€`layers`ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚`'root'`ãŒå·¦ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¢ã‚¦ãƒˆã—ã¦ã€`'dep-eng'`ãŒå³ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ã—ã¦ãã¾ã™ã€‚

```tsx
[
  { name: 'root', state: 'exitingOnNavigate' },
  { name: 'dep-eng', state: 'enteringOnNavigate' },
]
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
[
  { name: 'root', state: 'invisible' },
  { name: 'dep-eng', state: 'active' },
]
```

`back()`ã—ã¦éƒ¨ç½²ä¸€è¦§ã«æˆ»ã‚‹å ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
[
  { name: 'root', state: 'enteringOnBack' },
  { name: 'dep-eng', state: 'exitingOnBack' },
]
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```tsx
[
  { name: 'root', state: 'active' },
]
```

## ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹

`Layer`ã®å‹ãŒå¤‰ã‚ã£ãŸã®ã§ã€å‹ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
  type DrillDownProps = {
-   initialLayer: Layer;
+   initialLayerName: Layer['name']; // TODO: åˆæœŸè¡¨ç¤ºã‚’æ±ºã‚ã‚‹ãŸã‚ã«å¿…è¦ã ãŒã€ã§ãã‚Œã°ãªãã—ãŸã„
  };
  export const DrillDown: FC<PropsWithChildren<DrillDownProps>> = ({ children, initialLayer }) => {
-   const [layers, setLayers] = useState<Layer[]>([initialLayer]);
+   const [layers, setLayers] = useState<Layer[]>([{ name: initialLayerName, state: 'active' }]);

    return (
      <LayersStateContext.Provider value={[layers, setLayers]}>
        {children}
      </LayersStateContext.Provider>
    );
  };

  type DrillDownLayerProps = {
    name: string;
    content: ReactNode;
  };
  export const DrillDownLayer: FC<PropsWithChildren<DrillDownLayerProps>> = ({ children, name, content }) => {
    const context = use(LayersStateContext);
    if (context === null) {
      throw new Error('DrillDownLayer must be used within DrillDown');
    }
    const [layers] = context;
-   const ownLayer = layers.find((layer) => layer === name);
+   const ownLayer = layers.find((layer) => layer.name === name);
    if (!ownLayer) return null;

    const isCurrentLayer = ownLayer === layers.at(-1);

    return isCurrentLayer
      ? content
      : children;
  };
```

```diff tsx:src/App.tsx
  const DrillDownDemo: FC = () => {
    return (
-     <DrillDown initialLayer="root">
+     <DrillDown initialLayerName="root">
```

æ®‹ã‚‹`navigate`ã®å‹ã‚¨ãƒ©ãƒ¼ã‚’è§£æ¶ˆã—ã¤ã¤ã€`layers`ãŒã†ã¾ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

 `navigate`ã‚’å®Ÿè¡Œã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€ç¾åœ¨ã®éšå±¤ã‚’`exitingOnNavigate`ã«ã€æ¬¡ã®éšå±¤ã‚’`enteringOnNavigate`ã«è¨­å®šã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
    const navigate = useCallback<Navigate>((next) => {
      setLayers((layers) => {
+       const current = layers.at(-1);
+       if (!current) return layers;
  
        return [
-         ...layers,
-         next,
+         ...layers.slice(0, -1),
+         { name: current.name, state: 'exitingOnNavigate' },
+         { name: next, state: 'enteringOnNavigate' },
        ];
      });
    }, [setLayers]);
```

`back`ã‚‚åŒæ§˜ã«ã€ç¾åœ¨ã®éšå±¤ã‚’`exitingOnBack`ã«ã€å‰ã®éšå±¤ã‚’`enteringOnBack`ã«è¨­å®šã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
    const back = useCallback<Back>(() => {
      setLayers((layers) => {
+       const current = layers.at(-1);
+       if (!current) return layers;
+  
+       const previous = layers.at(-2);
+       if (!previous) return layers;
   
-       return layers.slice(0, -1);
+       return [
+         ...layers.slice(0, -2),
+         { name: previous.name, state: 'enteringOnBack' },
+         { name: current.name, state: 'exitingOnBack' },
+       ];
      });
    }, [setLayers]);
```

`DrillDownLayer`ã«ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ‚äº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã¨ãã«ã€`enteringOnXxx`ã®çŠ¶æ…‹ã‚’`active`ã«ã€`exitingOnXxx`ã®çŠ¶æ…‹ã‚’`invisible`ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
  export const DrillDownLayer: FC<PropsWithChildren<DrillDownLayerProps>> = ({ children, name, content }) => {
    const context = use(LayersStateContext);
    if (context === null) {
      throw new Error('DrillDownLayer must be used within DrillDown');
    }
    const [layers, setLayers] = context;
    const ownLayer = layers.find((layer) => layer.name === name);
    if (!ownLayer) return null;

-   const isCurrentLayer = ownLayer === layers.at(-1);
+   const onAnimationEnd: AnimationEventHandler<HTMLDivElement> = (_event) => {
+     const activateLayer = (layers: Layer[]): Layer[] => (
+       layers.map((layer) => (
+         layer.name === name
+           ? { name: layer.name, state: 'active' }
+           : layer
+       ))
+     );
+     const hideLayer = (layers: Layer[]): Layer[] => (
+       layers.map((layer) => (
+         layer.name === name
+           ? { name: layer.name, state: 'invisible' }
+           : layer
+       ))
+     );
+
+     if (ownLayer.state === 'enteringOnNavigate' || ownLayer.state === 'enteringOnBack') {
+       setLayers(activateLayer);
+     }
+     if (ownLayer.state === 'exitingOnNavigate' || ownLayer.state === 'exitingOnBack') {
+       setLayers(hideLayer);
+     }
+   };

-   return isCurrentLayer
-     ? content
-     : children
+    return (
+      <>
+        <div onAnimationEnd={onAnimationEnd}>
+          {content}
+        </div>
+        {children}
+      </>
+    );
  };
```

ã•ã‚‰ã«ã€`exitingOnBack`ã®å ´åˆã¯`layers`ã‹ã‚‰å–ã‚Šé™¤ãå‡¦ç†ãŒå¿…è¦ãªã®ã§ã€å®Ÿè£…ã—ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
    const onAnimationEnd: AnimationEventHandler<HTMLDivElement> = (_event) => {
      const activateLayer = (layers: Layer[]): Layer[] => (
        layers.map((layer) => (
          layer.name === name
            ? { name: layer.name, state: 'active' }
            : layer
        ))
      );
      const hideLayer = (layers: Layer[]): Layer[] => (
        layers.map((layer) => (
          layer.name === name
            ? { name: layer.name, state: 'invisible' }
            : layer
        ))
      );
+     const removeLayer = (layers: Layer[]): Layer[] => (
+       layers.filter((layer) => layer.name !== name)
+     );

      if (ownLayer.state === 'enteringOnNavigate' || ownLayer.state === 'enteringOnBack') {
        setLayers(activateLayer);
      }
-     if (ownLayer.state === 'exitingOnNavigate' || ownLayer.state === 'exitingOnBack') {
+     if (ownLayer.state === 'exitingOnNavigate') {
        setLayers(hideLayer);
      }
+     if (ownLayer.state === 'exitingOnBack') {
+       setLayers(removeLayer);
+     }
    };
```

å½“ç„¶ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ãªã„ã¨`onAnimationEnd`ã¯å®Ÿè¡Œã•ã‚Œãªã„ãŸã‚ã€cssã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚cssãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½•ã‚’ä½¿ã£ã¦ã‚‚ã‚ˆã„ã§ã™ãŒã€ã“ã“ã§ã¯`vanilla-extract`ã‚’ä½¿ã„ã¾ã™ã€‚tailwindã‚’ä½¿ã†å ´åˆã¯ã€`data-state`ãªã©ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
+ import * as styles from './drill-down.css';
```

```diff tsx:src/components/drill-down/drill-down.tsx
    return (
      <>
-       <div onAnimationEnd={onAnimationEnd}>
+       <div
+         onAnimationEnd={onAnimationEnd}
+         className={styles.layer({ state: ownLayer.state })}
+       >
          {content}
        </div>
        {children}
      </>
    );
```

```diff typescript:src/components/drill-down/drill-down.css.ts
+ import { keyframes } from '@vanilla-extract/css';
+ import { recipe } from '@vanilla-extract/recipes';
+
+ const slideInFromRight = keyframes({
+   '0%': { transform: 'translateX(100%)' },
+   '100%': { transform: 'translateX(0)' },
+ });
+ const slideOutToLeft = keyframes({
+   '0%': { transform: 'translateX(0)' },
+   '100%': { transform: 'translateX(-100%)' },
+ });
+ const slideInFromLeft = keyframes({
+   '0%': { transform: 'translateX(-100%)' },
+   '100%': { transform: 'translateX(0)' },
+ });
+ const slideOutToRight = keyframes({
+   '0%': { transform: 'translateX(0)' },
+   '100%': { transform: 'translateX(100%)' },
+ });
+ const animationDuration = '300ms';
+ const animationTimingFunction = 'ease-out';
+ const animationFillMode = 'forwards';
+
+ export const layer = recipe({
+   base: {},
+   variants: {
+     state: {
+       active: {},
+       enteringOnNavigate: {
+         animationName: slideInFromRight,
+         animationDuration,
+         animationTimingFunction,
+         animationFillMode,
+       },
+       exitingOnNavigate: {
+         animationName: slideOutToLeft,
+         animationDuration,
+         animationTimingFunction,
+         animationFillMode,
+       },
+       enteringOnBack: {
+         animationName: slideInFromLeft,
+         animationDuration,
+         animationTimingFunction,
+         animationFillMode,
+       },
+       exitingOnBack: {
+         animationName: slideOutToRight,
+         animationDuration,
+         animationTimingFunction,
+         animationFillMode,
+       },
+       invisible: {
+         display: 'none',
+       },
+     },
+   },
+ });
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã€`enteringOnXxx`ã¨`exitingOnXxx`ã®è¦ç´ ãŒç¸¦ã«ç©ã¾ã‚ŒãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€å„éšå±¤ã®è¦ç´ ã¯é‡ã­åˆã‚ã•ã£ãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„ã§ã™ã€‚

ã¾ãšã¯`DrillDown`ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å½“ã¦ã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
  export const DrillDown: FC<PropsWithChildren<DrillDownProps>> = ({ children, initialLayerName }) => {
    const [layers, setLayers] = useState<Layer[]>([{ name: initialLayerName, state: 'active' }]);

    return (
      <LayersStateContext.Provider value={[layers, setLayers]}>
-       {children}
+       <div className={styles.container}>
+         {children}
+       </div>
      </LayersStateContext.Provider>
    );
  };
```

`gridTemplateAreas`ã‚’ä½¿ãˆã°ã€`position: absolute`ã‚’ä½¿ã‚ãšã«é‡ã­åˆã‚ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆ[ãƒ¢ãƒ€ãƒ³CSSã«ã‚ˆã‚‹çµ¶å¯¾é…ç½®ï¼ˆposition: absolute;ï¼‰ã®å‰Šæ¸›](https://coliss.com/articles/build-websites/operation/css/less-absolute-positioning-modern-css.html)ï¼‰

```diff typescript:src/components/drill-down/drill-down.css.ts
+ export const container = style({
+   display: 'grid',
+   gridTemplateAreas: '"layer"',
+ });
```

`DrillDownLayer`ã«å½“ã¦ã¦ã„ã‚‹`layer`ã«ã€æ¬¡ã®ã‚ˆã†ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff typescript:src/components/drill-down/drill-down.css.ts
  export const layer = recipe({
-   base: {},
+   base: {
+     gridArea: 'layer',
+   },
```

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã®ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã§ãã¾ã—ãŸã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-fqep4pew?file=src%2Fcomponents%2Fdrill-down%2Fdrill-down.tsx)

## æœ€å¾Œã®ä»•ä¸Šã’

```tsx:src/components/drill-down/drill-down.tsx
type DrillDownProps = {
  initialLayerName: Layer['name']; // TODO: åˆæœŸè¡¨ç¤ºã‚’æ±ºã‚ã‚‹ãŸã‚ã«å¿…è¦ã ãŒã€ã§ãã‚Œã°ãªãã—ãŸã„
};
```

ã“ã‚Œã‚’è§£æ±ºã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚`DrillDown`ã®æœ€åˆã®childrenã®props`name`ãŒè‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

[`Children.toArray`](https://ja.react.dev/reference/react/Children#children-toarray)ã‚’ä½¿ã†ã“ã¨ã§ã€`DrillDown`ã®æœ€åˆã®childrenã®propsã‚’å–å¾—ã§ãã¾ã™ã€‚

```diff tsx:src/components/drill-down/drill-down.tsx
- type DrillDownProps = {
-   initialLayerName: Layer['name']; // TODO: åˆæœŸè¡¨ç¤ºã‚’æ±ºã‚ã‚‹ãŸã‚ã«å¿…è¦ã ãŒã€ã§ãã‚Œã°ãªãã—ãŸã„
- };
- export const DrillDown: FC<PropsWithChildren<DrillDownProps>> = ({ children, initialLayerName }) => {
+ export const DrillDown: FC<PropsWithChildren> = ({ children }) => {
+   const firstLayerName = useMemo(() => {
+     const firstChild = Children.toArray(children)[0];
+     if (isValidElement(firstChild) && firstChild.type === DrillDownLayer) {
+       const firstChildProps = firstChild.props as DrillDownLayerProps;
+       return firstChildProps.name;
+     }
+     throw new Error('DrillDown component children must be DrillDownLayer');
+   }, [children]);
-   const [layers, setLayers] = useState<Layer[]>([{ name: initialLayerName, state: 'active' }]);
+   const [layers, setLayers] = useState<Layer[]>([{ name: firstLayerName, state: 'active' }]);
```

```diff tsx:src/App.tsx
  const DrillDownDemo: FC = () => {
    return (
-     <DrillDown initialLayer="root">
+     <DrillDown>
```

:::message
`Children`ã‚‚`isValidElement`ã‚‚[ãƒ¬ã‚¬ã‚·ãƒ¼ãªAPIã¨ã—ã¦ã€ä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¦ã„ãªã„](https://ja.react.dev/reference/react/legacy)ã®ã§ã€ä»£æ›¿ã®æ–¹æ³•ã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
:::

å®Œæˆï¼

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-iozycbtu?file=src%2Fcomponents%2Fdrill-down%2Fdrill-down.tsx)

## ä¸å¤ªè©±

ã€Œã“ã†ã„ã†APIã§ä½¿ãˆã‚‹ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¦ã€ã¨ã€å‹ã‚‚ãƒ†ã‚¹ãƒˆã‚‚ç”¨æ„ã—ãŸçŠ¶æ…‹ã§AI Agentã«è¨­è¨ˆãƒ»å®Ÿè£…ã‚’ä¾é ¼ã—ãŸã®ã§ã™ãŒã€ã†ã¾ãã„ãã¾ã›ã‚“ã§ã—ãŸã€‚

ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—ã®ã¨ã“ã‚ã¾ã§ã¯å‹•ãã‚‚ã®ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§ã™ãŒã€ãã‚Œã§ã‚‚ä¸è¦ãªstateãŒãŸãã•ã‚“ã‚ã£ãŸã‚Šæ‰‹ç¶šãçš„ã§èª­ã¿ã«ãã„ã‚³ãƒ¼ãƒ‰ãŒå¤šã‹ã£ãŸã‚Šã—ã¦ã€ã‚ã¾ã‚Šã„ã„ã‚³ãƒ¼ãƒ‰ã¨ã¯è¨€ãˆãªã„çŠ¶æ…‹ã§ã—ãŸã€‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã«é–¢ã—ã¦ã¯ã€é€”ä¸­ã‹ã‚‰æŠœã‘å‡ºã›ãªã„æ²¼ã«ãƒãƒã£ã¦ã—ã¾ã„ã€å®Œæˆã•ã›ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

ã“ã‚Œã‹ã‚‰ä¼¼ãŸã‚ˆã†ãªå®Ÿè£…ã‚’ã—ã‚ˆã†ã¨ã—ãŸAI AgentãŒã€ã“ã®è¨˜äº‹ã‚’è¦‹ã¤ã‘ã¦è‡ªåˆ†ã§å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ãã‚Œã‚Œã°ã„ã„ãªã¨æ€ã„ã¾ã™ã€‚äººé–“ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒˆãƒ¬ãƒ¼ã‚¹ã—ãŸè¨˜äº‹ã¨ã—ã¦ã€AIå­¦ç¿’ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
